#!groovy
node ("slc6_x86-64-relval") {
  stage "Run tests"
  withEnv(["ALIPHYSICS_VERSION=${ALIPHYSICS_VERSION}"]){
    sh '''
      # If we do not find the required release in the official area,
      # let's ask for the test one.
      eval `/cvmfs/alice.cern.ch/bin/alienv printenv AliPhysics/$ALIPHYSICS_VERSION`
      which aliroot
      if ! which aliroot > /dev/null 2>&1; then
        eval `/cvmfs/alice-test.cern.ch/bin/alienv printenv AliPhysics/$ALIPHYSICS_VERSION`
      fi
      which aliroot > /dev/null 2>&1 || exit 40

      echo $ALICE_PHYSICS

      export X509_CERT_DIR="/cvmfs/grid.cern.ch/etc/grid-security/certificates"
      export X509_USER_PROXY="/secrets/eos-proxy"
      [ -f "$X509_USER_PROXY" ] || exit 41

      sh -ex $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/runEMCalJetSampleTask.sh AOD LHC11h fileLists/files_LHC11h_2_AOD145.txt 1000
      sh -ex $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/runEMCalJetSampleTask.sh AOD LHC12c fileLists/files_LHC12c_pass2_AOD.txt 10000

    '''
  }
}
